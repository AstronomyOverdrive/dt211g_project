const e=document.getElementById("notification"),t=document.getElementById("data-container"),n=document.getElementById("earth");document.getElementById("map");const o=document.getElementById("pos-header"),a=document.getElementById("pos-text"),s=document.getElementById("iss-header"),i=document.getElementById("iss-text"),r=document.getElementById("loader"),l=document.getElementById("warning"),d=document.getElementById("start"),c=document.getElementById("start-btn"),p=document.getElementById("refresh-btn");let m=!0;const y=L.map("map").setView([0,0],10),g=L.marker([0,0]).addTo(y);async function h(l,c,p){try{let e=await fetch(l);if(!e.ok)throw Error("Invalid response!");let v=await e.json();switch(c){case"setCoords":!function(e){var n,o;let a=e.iss_position.latitude,s=e.iss_position.longitude;t.style.display="none",r.style.display="block",n=a,o=s,h(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${n}&lon=${o}`,"showPlaceInfo"),h("https://epic.gsfc.nasa.gov/api/natural","getAvailableImages",s),h("http://api.open-notify.org/astros.json","showPeopleOnISS"),y.panTo([a,s]),g.setLatLng([a,s]),r.style.display="none",d.style.height=0,t.style.display="grid",y.invalidateSize()}(v);break;case"showPlaceInfo":var m=v;if(void 0!==m.address){let e=m.address.region,t=m.address.country,n=m.licence;o.textContent="What country is the ISS over?",void 0!==m.address.region?a.innerText=`The ISS is currently over ${e}, ${t}.
${n}`:a.innerText=`The ISS is currently over ${t}.
${n}`}else o.textContent="The ISS is currently not over any known country!",a.textContent="Please check back again later.";break;case"getAvailableImages":var u=v,I=p;let S=u[0];u.forEach(e=>{Math.abs(I-e.centroid_coordinates.lon)<Math.abs(I-S.centroid_coordinates.lon)&&(S=e)});let w={year:S.date.split(" ")[0].split("-")[0],month:S.date.split(" ")[0].split("-")[1],day:S.date.split(" ")[0].split("-")[2],file:S.image,title:S.caption,lon:S.centroid_coordinates.lon,lat:S.centroid_coordinates.lat};n.src=`https://epic.gsfc.nasa.gov/archive/natural/${w.year}/${w.month}/${w.day}/png/${w.file}.png`,n.alt=w.title;break;case"showPeopleOnISS":var f=v;let E=f.people.filter(e=>"ISS"===e.craft),b="Current people on the ISS are:";E.forEach(e=>{b+=`
\u{2022} ${e.name}`}),s.textContent="ISS Astronauts",i.innerText=b;break;default:console.log("Invalid choice!")}}catch(t){console.error(t),e.textContent="An error occured, please try again later!",e.classList.remove("hidden"),e.classList.add("scroll-down"),setTimeout(()=>{e.classList.remove("scroll-down"),e.classList.add("hidden")},7e3)}}L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>"}).addTo(y),p.addEventListener("click",function(){m&&(p.disabled=!0,m=!1,h("http://api.open-notify.org/iss-now.json","setCoords"),setTimeout(()=>{p.disabled=!1,m=!0},1e4))}),c.addEventListener("click",function(){c.disabled=!0,c.classList.add("hidden"),l.style.display="none",h("http://api.open-notify.org/iss-now.json","setCoords")});