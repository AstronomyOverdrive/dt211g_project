const e=document.getElementById("notification"),t=document.getElementById("data-container"),n=document.getElementById("earth");document.getElementById("map");const o=document.getElementById("pos-header"),a=document.getElementById("pos-text"),s=document.getElementById("iss-header"),i=document.getElementById("iss-text"),r=document.getElementById("loader"),l=document.getElementById("start"),d=document.getElementById("start-btn"),c=document.getElementById("refresh-btn");let p=!0;const m=L.map("map").setView([0,0],10),h=L.marker([0,0]).addTo(m);async function y(d,c,p){try{let e=await fetch(d);if(!e.ok)throw Error("Invalid response!");let v=await e.json();switch(c){case"setCoords":!function(e){var n,o;let a=e.iss_position.latitude,s=e.iss_position.longitude;t.style.display="none",r.style.display="block",n=a,o=s,y(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${n}&lon=${o}`,"showPlaceInfo"),y("https://epic.gsfc.nasa.gov/api/natural","getAvailableImages",s),y("http://api.open-notify.org/astros.json","showPeopleOnISS"),m.panTo([a,s]),h.setLatLng([a,s]),r.style.display="none",l.style.height=0,t.style.display="grid",m.invalidateSize()}(v);break;case"showPlaceInfo":var g=v;if(void 0!==g.address){let e=g.address.region,t=g.address.country,n=g.licence;o.textContent="What country is the ISS over?",void 0!==g.address.region?a.innerText=`The ISS is currently over ${e}, ${t}.
${n}`:a.innerText=`The ISS is currently over ${t}.
${n}`}else o.textContent="The ISS is currently not over any known country!",a.textContent="Please check back again later.";break;case"getAvailableImages":var u=v,I=p;let S=u[0];u.forEach(e=>{Math.abs(I-e.centroid_coordinates.lon)<Math.abs(I-S.centroid_coordinates.lon)&&(S=e)});let w={year:S.date.split(" ")[0].split("-")[0],month:S.date.split(" ")[0].split("-")[1],day:S.date.split(" ")[0].split("-")[2],file:S.image,title:S.caption,lon:S.centroid_coordinates.lon,lat:S.centroid_coordinates.lat};n.src=`https://epic.gsfc.nasa.gov/archive/natural/${w.year}/${w.month}/${w.day}/png/${w.file}.png`,n.alt=w.title;break;case"showPeopleOnISS":var f=v;let E=f.people.filter(e=>"ISS"===e.craft),b="Current people on the ISS are:";E.forEach(e=>{b+=`
\u{2022} ${e.name}`}),s.textContent="ISS Astronauts",i.innerText=b;break;default:console.log("Invalid choice!")}}catch(t){console.error(t),e.textContent="An error occured, please try again later!",e.classList.remove("hidden"),e.classList.add("scroll-down"),setTimeout(()=>{e.classList.remove("scroll-down"),e.classList.add("hidden")},7e3)}}L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>"}).addTo(m),c.addEventListener("click",function(){p&&(c.disabled=!0,p=!1,y("http://api.open-notify.org/iss-now.json","setCoords"),setTimeout(()=>{c.disabled=!1,p=!0},1e4))}),d.addEventListener("click",function(){d.disabled=!0,d.classList.add("hidden"),y("http://api.open-notify.org/iss-now.json","setCoords")});