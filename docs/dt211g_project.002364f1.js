const e=document.getElementById("notification"),t=document.getElementById("data-container"),n=document.getElementById("earth");document.getElementById("map");const o=document.getElementById("pos-header"),a=document.getElementById("pos-text"),s=document.getElementById("iss-header"),i=document.getElementById("iss-text"),r=document.getElementById("loader"),l=document.getElementById("warning"),d=document.getElementById("start"),c=document.getElementById("start-btn"),p=document.getElementById("refresh-btn");let y=!0,h=0;const m=L.map("map").setView([0,0],10),g=L.marker([0,0]).addTo(m);async function u(t,r,l){try{let e=await fetch(t);if(!e.ok)throw Error("Invalid response!");let h=await e.json();switch(r){case"setCoords":!function(e){var t,n;let o=e.iss_position.latitude,a=e.iss_position.longitude;t=o,n=a,u(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${t}&lon=${n}`,"showPlaceInfo"),u("https://epic.gsfc.nasa.gov/api/natural","getAvailableImages",a),u("http://api.open-notify.org/astros.json","showPeopleOnISS"),m.panTo([o,a]),g.setLatLng([o,a]),I()}(h);break;case"showPlaceInfo":var d=h;if(void 0!==d.address){let e=d.address.region,t=d.address.country,n=d.licence;o.textContent="What country is the ISS over?",void 0!==d.address.region?a.innerText=`The ISS is currently over ${e}, ${t}.
${n}`:a.innerText=`The ISS is currently over ${t}.
${n}`}else o.textContent="The ISS is currently not over any known country!",a.textContent="Please check back again later.";I();break;case"getAvailableImages":var c=h,p=l;let f=c[0];c.forEach(e=>{Math.abs(p-e.centroid_coordinates.lon)<Math.abs(p-f.centroid_coordinates.lon)&&(f=e)});let v={year:f.date.split(" ")[0].split("-")[0],month:f.date.split(" ")[0].split("-")[1],day:f.date.split(" ")[0].split("-")[2],file:f.image,title:f.caption,lon:f.centroid_coordinates.lon,lat:f.centroid_coordinates.lat};n.src=`https://epic.gsfc.nasa.gov/archive/natural/${v.year}/${v.month}/${v.day}/png/${v.file}.png`,n.alt=v.title,I();break;case"showPeopleOnISS":var y=h;let S=y.people.filter(e=>"ISS"===e.craft),w="Current people on the ISS are:";S.forEach(e=>{w+=`
\u{2022} ${e.name}`}),s.textContent="ISS Astronauts",i.innerText=w,I();break;default:console.log("Invalid choice!")}}catch(t){console.error(t),e.textContent="An error occured, please try again later!",e.classList.remove("hidden"),e.classList.add("scroll-down"),setTimeout(()=>{e.classList.remove("scroll-down"),e.classList.add("hidden")},7e3)}}function I(){(h+=1)>3&&(r.style.display="none",d.style.height=0,t.style.display="grid",m.invalidateSize(),p.disabled=!0,setTimeout(()=>{p.disabled=!1,y=!0},1e4))}L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>"}).addTo(m),p.addEventListener("click",function(){y&&(y=!1,h=0,t.style.display="none",d.style.height="80vh",r.style.display="block",u("http://api.open-notify.org/iss-now.json","setCoords"))}),c.addEventListener("click",function(){c.disabled=!0,c.classList.add("hidden"),l.style.display="none",h=0,t.style.display="none",d.style.height="80vh",r.style.display="block",u("http://api.open-notify.org/iss-now.json","setCoords")});